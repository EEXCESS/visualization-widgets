<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="js/lib/isotope.css">
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div class="grid">
    <div class="grid-sizer"></div>
</div>

<script src="js/lib/jquery-1.10.1.min.js"></script>
<script src="js/lib/isotope.pkgd.min.js"></script>
<script type="text/javascript">

    $(document).ready(function () {


    });


    window.onmessage = function (msg) {
        if (msg.data.event) {
            if (msg.data.event === 'eexcess.newSearchTriggered') {
                // new search has been triggered somewhere, show loading bar or similar
            }
            else if (msg.data.event === 'eexcess.newResults') {
                // new results are available in msg.data.data


                //show favicons
//                $.each(msg.data.data.result, function (idx, val) {
//                    $('body').append('<img src="' + msg.data.data.faviconURL + val.documentBadge.provider + '" />');
//                });


                //show images
                $.each(msg.data.data.result, function (idx, val) {

                    if (val.mediaType == "IMAGE") {
                        $('.grid').append('<img class = "grid-item" src="' + val.previewImage + '" />');
//                        console.log(val.previewImage);

                    }
                    $('.grid').isotope('reloadItems');
                    $('.grid').isotope({
                        itemSelector: '.grid-item',
                        percentPosition: true,
                        masonry: {

                            columnWidth: '.grid-sizer'
                        }
                    });

                });


                // get details for all results
                var documentBadges = [];
                $.each(msg.data.data.result, function (idx, val) {
                    documentBadges.push(val.documentBadge);
                });
                window.top.postMessage({
                    event: 'eexcess.detailsRequest',
                    data: documentBadges
                }, '*');
            }

            else if (msg.data.event === 'eexcess.detailsResponse') {
                // details received in msg.data.data
            }
        }
    }
    ;
</script>
</body>
</html>
